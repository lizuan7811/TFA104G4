<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>聊天室</title>

<script type="text/javascript"
	src="jquery/practice/vendors/jquery/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
	var ws;

	var MyPoint = "TFA104G4/lizuan";
	var host = window.location.host;
	var path = window.location.pathname;
	var webCtx = path.substring(0, path.indexOf("/", 1));
// 	var endPointURL = "ws://" + host + webCtx + MyPoint;
// 	var endPointURL ="ws://" + host + webCtx +"/WSServePoint/chatroom";
	var endPointURL="ws://localhost:8081/TFA104G4/chatroom";

	var statusOutput = document.getElementById("statusOutput");
// 	var webSocket;

	$(function() {
		ws_connect();
    $("#send").click(function(){
      ws_sendMsg();
    });
//     ws.onopen = function(event) {
// 			document.getElementById("").disabled = false;
// 		};

	});

	function ws_connect() {
		if ("WebSocket" in window) {
			ws = new WebSocket(endPointURL);
		} else if ("MozWebSocket" in window) {
			ws = new MozWebSocket(endPointURL);
		} else {
			console.log("Error:WebSocket is not supported by this browser.");
		}
		
	};
	ws.onopen = function() {
		console.log("Info:WebSocket connection opened.");
	}

	ws.onclose = function() {
		console.log("Info:WebSocket closed");
	}

	ws.onmessage = function(message) {
		console.log(message.data);
	}
	
	function ws_sendMsg() {
		var userName = $("userName").val();
		var message=$("#message").val();
   		 ws.send(message);
		// if (userName === "") {
		// 	alert("Input a user name");
		// 	inputUserName.focus();
		// 	return;
		// }

		if(message==="")
		{
			alert("Input a message");
			inputMessage.focus();
		}
		else
		{
			var jsonObj={
			"userName":userName,
			"message":message
			};
			ws.send(JSON.stringify(jsonObj));
			$("message").val();
			$("message").focus();
		}
	};

	function disconnect()
	{
		webSocket.close();
		document.getElementById("").disabled=true;
	}
	var statusOutput=document.getElementById("statusOutput");
	function updateStatus(newStatus){
		statusOutput.innerHTML=newStatus;
	}

</script>
</head>

<body>
	<table style="border: 1px solid #00F;">
		<tbody>
			<tr>
				<td colspan="2" align="cneter">
					<h3>Welcome to use this system!</h3>
				</td>
			</tr>
			<tr>
				<td width="500px" height="300px"
					style="border: 1px solid #00F; vertical-align: top;" name="content">
					<div style="background-color: white;">
						<table id="tdRecord">
							<tbody id="record"
								style="display: block; height: 300px; width: 500px; overflow: auto" />
						</table>
					</div>
				</td>
				<td width="100px"
					style="border: 1px solid #00F; vertical-align: top;">
					<div style="overflow: auto;">
						<table id="tbuserList">
							<tbody =id="userList"
								style="display: block; height: 300px; overflow: auto;" />
						</table>
					</div>
				</td>
			</tr>
		</tbody>
	</table>
	<div>
		<input id="userName" class="text-field" type="text"	placeholder="User name" />
		<input id="message" class="text-field" type="text" placeholder="Message" />
		<button id="send" class="" name="send" value="send">send</button>
	</div>

</body>
</html>
